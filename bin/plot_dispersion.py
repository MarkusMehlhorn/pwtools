#!/usr/bin/env python3

# Plot a dispersion generated by QE's matdyn.x. This is a version of QE's
# plotband.x, which produces a nice matplotlib figure :) Reads a k-point -
# frequency file produced by QE's matdyn.x (flfrq in matdyn.x input).
#
# This is only intended as a quick inspection tool. For labeling special
# points, see examples/dispersion/ for a more complete example.

# usage:
#   plot_dispersion.py matdyn.freq
#   
# matdyn.x must have been instructed to calculate a phonon dispersion along a
# predefined path in the BZ. e.g. natom=2, nbnd=6, 101 k-points on path
#     
# `matdyn.in`::
#
#     &input
#         asr='crystal',  
#         amass(1)=26.981538,
#         amass(2)=14.00674,
#         flfrc='fc',
#         flfrq='matdyn.freq.disp'
#     /
#     101                                | nks
#     0.000000    0.000000    0.000000   |
#     0.037500    0.037500    0.000000   | List of nks = 101 k-points
#     ....                               |
#
# `matdyn_freq` has the form::
#
#     <header>
#     <k-point, (3,)>
#     <frequencies,(nbnd,)
#     <k-point, (3,)>
#     <frequencies,(nbnd,)
#     ...
# 
# for example::
#
#     &plot nbnd=   6, nks= 101 /
#               0.000000  0.000000  0.000000
#       0.0000    0.0000    0.0000  456.2385  456.2385  871.5931
#               0.037500  0.037500  0.000000
#      23.8811   37.3033   54.3776  455.7569  457.2338  869.8832
#      ....


if __name__ == '__main__':
    import warnings
    warnings.simplefilter('always')
    import matplotlib.pyplot as plt
    import sys
    from pwtools.pwscf import read_matdyn_freq
    from pwtools.kpath import plot_dis, get_path_norm
    
    if len(sys.argv) > 2:
        warnings.warn('kpath definition file no longer supported')

    # QE 5.x: plot matdyn.freq.gp
    #
    ##import numpy as np
    ##data = np.loadtxt(sys.argv[1])
    ##path_norm = data[:,0]
    ##freqs = data[:,1:]
    
    ks, freqs = read_matdyn_freq(sys.argv[1])
    path_norm = get_path_norm(ks)

    plt.plot(path_norm, freqs, 'k')
    plt.show()

